<!--
C1 generated!!
<title>2011-03-05 Composite C1 Security - Mail Munging</title>
<meta name="Description" content="2011-03-05 Composite C1 Security - Mail Munging - Email protection on web sites" />
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
</head>
<body lang="en-us" xml:lang="en-us">
	<f:function name="HolisticWare.Optimizations.SearchEngine.MetaTagsKeywords" xmlns:f="http://www.composite.net/ns/function/1.0">
	  <f:param name="KeywordsAdditional" value="2011-03-05, Composite, C1, Security, Mail, Munging" />
	  <f:param name="AuthorsAdditional" value="mcvjetko" />
	  <f:param name="Date" value="2011-03-05" />
	  <f:param name="Language" value="en" />
	</f:function>
	<h1><a id="">2011-03-05 Composite C1 Security - Mail Munging</a></h1>
	<!-- ================================================================== -->

	<p>Date: 2011-03-05</p>

	<h2><a id="">Mail Munging general</a></h2>

	<p>
	Do You need Viagra? Cialis? I don't...
	<br />
	Do You want someone suggest You that You need products from above? For me even less...
	<br />
	So what can be done against it? ... a lot...
	<br />
	The investigation of 50+ Croatian web pages revealed that more than 80% pays no
	attention to contact security on web sites. (Other 20% use forms for feedback).
	<br />
	There is often need to publish contacts and mails on the web site and
	it is normal and natural to want customers/clients/partners to give any
	for of feedback.
	<br />
	And for feedback some kind of contact is needed, so everyone expose contacts on 
	sites, mails, phone numbers, skype contacts in form of uris:
	</p>
	<pre class="hw_code">
	mailto:name@host.domain.tld
	skype:username?call
	sip:+1-212-555-1212:1234@gateway.com;user=phone
	</pre>
	<p>
	The problem is that anything that is exposed within html can be used for 
	malicious purposes and be might be harvested not only by good guys 
	(search engines like google's-googlebot), but from bad guys (spambots) 
	rather than our desired/aimed customers/clients....
	</p>
	<p>
	So there is compromise to find between need to present what one does and potential
	damage one can suffer...
	</p>
	<p>
	The emphasis here will be on e-mail contacts (uris) although it could be applied
	to phone numbers, skype accounts etc.
	In the years to come protecting later contact/uri types) will gain on importance 
	as the bad guys will start to call us in the middle of the night asking questions 
	from the beginning of this write-up.
	</p>
	<p>	
	In order to reduce readability of html uri tags and therefore reducing chances
	for spambots to harvest emails, mail tags (mailto:) can be generated through 
	javascript...
	</p>
	
	<h2><a id="">Self-Defense</a></h2>
	<p>
	The possible solution would be either not to expose contacts in html which is 
	contradictory with idea of web marketing or to render contacts dynamically.
	</p>
	<p>
	References:
	<br />
	<a href="http://en.wikipedia.org/wiki/Address_munging">
	http://en.wikipedia.org/wiki/Address_munging
	</a>
	<br />
	<a href="http://www.projecthoneypot.org/how_to_avoid_spambots_3.php">
	http://www.projecthoneypot.org/how_to_avoid_spambots_3.php
	</a>
	</p>

	<p>
	Sample javascript (javascript used by our team is not explained here, because of
	security reasons - sure this is small hurdle for spammers and battle almost not worth
	fighting, but it is still a hurdle and brings a little bit of protection).
	<br />
	Put this javascript after <code>&lt;head&gt;</code> tag or in external script... 
	</p>

	<pre class="hw_class">
&lt;script language=&quot;javascript&quot;&gt;
function gNNHtBTTZNGeaSs()
{
var KjgtOIOnBciNKhh=[&quot;x79&quot;,&quot;111&quot;,&quot;117&quot;,&quot;114&quot;,&quot;x40&quot;,&quot;x65&quot;,&quot;x6d&quot;,&quot;x61&quot;,&quot;x69&quot;,&quot;x6c&quot;,&quot;x2e&quot;,&quot;97&quot;,&quot;x64&quot;,&quot;100&quot;,&quot;114&quot;,&quot;101&quot;,&quot;x73&quot;,&quot;x73&quot;];
var ejxHXtNyBKYIGEP=['?','s','u','b','j','e','c','t','=','&amp;','c','c','=','&amp;','b','c','c','=','&amp;','b','o','d','y','='];
var UZJiVYorEtUTMEF=[&quot;x79&quot;,&quot;111&quot;,&quot;117&quot;,&quot;x72&quot;,&quot;x40&quot;,&quot;x65&quot;,&quot;109&quot;,&quot;x61&quot;,&quot;x69&quot;,&quot;x6c&quot;,&quot;46&quot;,&quot;97&quot;,&quot;x64&quot;,&quot;100&quot;,&quot;x72&quot;,&quot;101&quot;,&quot;115&quot;,&quot;x73&quot;];
document.write(&quot;&lt;a href=\&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#x3a;&quot;);
for (i=0; i&lt;KjgtOIOnBciNKhh.length; i++) document.write('&amp;#'+KjgtOIOnBciNKhh[i]+';');
for (i=0; i&lt;ejxHXtNyBKYIGEP.length; i++) document.write(ejxHXtNyBKYIGEP[i]);
document.write('&quot; style=&quot;&quot; class=&quot;&quot; id=&quot;&quot;&gt;');
for (i=0; i&lt;UZJiVYorEtUTMEF.length; i++) document.write('&amp;#'+UZJiVYorEtUTMEF[i]+';');
document.write('&lt;/a&gt;');
}
&lt;/script&gt;
	</pre>

	<p>
	Calling munging function on the place where mailto tag should be inserted/injected
	into html...
	</p>

	<pre class="hw_class">
&lt;script language=&quot;javascript&quot;&gt;
gNNHtBTTZNGeaSs();
&lt;/script&gt;
</pre>

	<h3><a id="">Online Javascript mungers</a></h3>
	<p>
	<a href="http://www.addressmunger.com/">
	http://www.addressmunger.com/
	</a>
	</p>


	<h3><a id="">Caveats</a></h3>
	<ul>
		<li>
		javascript support must be enabled 
		<br />
		(don't forget today (2011-06-08) javascript is disabled on less than 2% visits.
		(yahoo developer network 2010-10)
		</li>
		<li>
		javascript must be loaded and called during html rendering (at the beginning),
		meaning it cannot be loaded at the end for speed optimizations like rest of
		javascript.
		<br />
		This implies splitting of javascript on pre-load and post-load and slightly
		worse points on page speed and yslow tests.
		<br />
		... again tradeoff...
		</li>
	</ul>

	<h2><a id="">Uri Security in Composite C1 (XSLT function)</a></h2>

	<h3><a id="">XSLT function</a></h3>
	<p>
	In:
	</p>

	<pre class="hw_code">
	\Website\App_Data\Composite\DataStores\Composite.Data.Types.IXsltFunctions_public.xml 
	</pre>
	<pre class="hw_code">
	&lt;XsltFunction Id="14c85b1d-7eba-459f-8b0a-5c63a3177e83"
	Name="EMailAntiSpamProtection" Namespace="HolisticWare.Security"
	Description="EMail security through munging with Javascript"
	OutputXmlSubType="XHTML"
	XslFilePath="\HolisticWare\Security\EMailAntiSpamProtection.xsl" /&gt;
	</pre>

	<h3><a id="">Function code</a></h3>

	<pre class="hw_code">
	&lt;?xml version="1.0" encoding="UTF-8"?&gt;
	&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	xmlns:in="http://www.composite.net/ns/transformation/input/1.0"
	xmlns:lang="http://www.composite.net/ns/localization/1.0"
	xmlns:f="http://www.composite.net/ns/function/1.0"
	xmlns="http://www.w3.org/1999/xhtml"
	exclude-result-prefixes="xsl in lang f"&gt;

	&lt;xsl:template match="/"&gt;
	&lt;html&gt;
	&lt;head&gt;
	&lt;!-- markup placed here will be shown in the head section of the rendered page --&gt;

	&lt;!-- needed for preloading and generating e-mails --&gt;
	&lt;script type="text/javascript" src="/js/hw_pre_20110325.js"/&gt;

	&lt;/head&gt;
	&lt;body&gt;
	&lt;!-- markup placed here will be the output of this rendering --&gt;
	&lt;script type="text/javascript" &gt;
	e_post
	(
	"&lt;xsl:value-of select="/in:inputs/in:param[@name='User']" /&gt;"
	, new Array
	(
	&lt;xsl:value-of select="/in:inputs/in:param[@name='Server']" /&gt;
	)
	, "&lt;xsl:value-of select="/in:inputs/in:param[@name='Subject']" /&gt;"
	, "&lt;xsl:value-of select="/in:inputs/in:param[@name='CC']" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" /&gt;"
	, "&lt;xsl:value-of select="/in:inputs/in:param[@name='BCC']" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" /&gt;"
	, "&lt;xsl:value-of select="/in:inputs/in:param[@name='Body']" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" /&gt;"
	, "&lt;xsl:value-of select="/in:inputs/in:param[@name='Display']" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" /&gt;"
	);
	&lt;/script&gt;
	&lt;/body&gt;
	&lt;/html&gt;
	&lt;/xsl:template&gt;

	&lt;/xsl:stylesheet&gt;
	</pre>

	<h3><a id="">Function parameters</a></h3>

	<h3><a id="">Function usage in C1</a></h3>
	

	<h2><a id="">HTML and URL encodings</a></h2>

	<pre class="hw_code">
	user
		 html user
		 url  %75%73%65%72

	username
		 html username
		 url  %75%73%65%72%6E%61%6D%65

	localhost
		 html localhost
		 url  %6C%6F%63%61%6C%68%6F%73%74

	localdomain
		 html localdomain
		 url  %6C%6F%63%61%6C%64%6F%6D%61%69%6E

	tld
		 html tld
		 url  %74%6C%64
	</pre>
</body>
</html>
